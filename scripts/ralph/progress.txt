# Ralph Progress Log

This file tracks completed stories. Append-only.

---
[INIT] - Ralph loop initialized
Status: DONE
Notes: Setup complete. Ready for first story.
---
[FND-001] - Verification harness setup
Status: DONE
Notes: Added pnpm verify/typecheck scripts. Fixed 7 lint errors (unused imports, unescaped apostrophes). Lint + typecheck pass. Build requires network for Google Fonts.
---
[FND-002] - Data layer + migrations + seed demo data
Status: DONE
Notes: Created 6 SQL migrations (profiles, leads, tenders, jobs, cases, compliance_docs). Updated lib/supabase/types.ts with all types. Created JSON seed data: 6 tenders, 10 leads, 4 jobs, 8 cases, 8 compliance docs.
---
[FND-003] - Auth + RBAC skeleton + /admin protect
Status: DONE
Notes: Implemented Supabase Auth with magic link. Created middleware.ts to protect /dashboard routes. Created lib/supabase/auth.ts with RBAC utilities (hasRole, canAccessRoute, canPerformAction). Updated login page to use real Supabase Auth. Created auth callback route. Updated dashboard header with logout. Security review completed with GDPR DELETE policies added.
---
[FND-004] - Uploads & media asset handling
Status: DONE
Notes: Created media_assets table migration. Implemented lib/supabase/storage.ts with upload utilities (validateFile, uploadFile, createMediaAsset, deleteFile). Created /api/upload route with file type/size validation. Supports images (jpg, png, gif, webp, svg) and documents (pdf, doc, docx, xls, xlsx, csv). 10MB default limit.
---
[FND-005] - Audit log basis
Status: DONE
Notes: Created audit_logs table with database triggers for automatic logging. Actions: LOGIN, LOGOUT, LOGIN_FAILED, CREATE, UPDATE, DELETE, VIEW, DOWNLOAD, EXPORT, STATUS_CHANGE, ASSIGNMENT. Created lib/audit.ts with helper functions (logLogin, logLogout, logView, logDownload, getAuditLogs, getEntityAuditHistory). Triggers auto-log leads, tenders, jobs, job_applications, cases, compliance_docs.
---
[PUB-010] - SEO baseline
Status: DONE
Notes: Created sitemap.ts with static pages + project detail pages. Created robots.ts with disallow for api/dashboard/auth routes. Added route-specific layouts with metadata for: over-ons, diensten, projecten, procurement, werken-bij, contact, duurzaamheid. Each page now has unique title, description, OpenGraph tags, and canonical URLs.
---
[PUB-020] - Diensten structure alignment
Status: DONE
Notes: Created /diensten/bouw-renovatie page (nieuwbouw, renovatie, erfgoed) with service cards and scope boundaries (wat wel/niet). Created /diensten/facility page with raamcontracten, preventief onderhoud, interventies, technisch beheer. Both pages have CTAs to projectplanner and clear scope sections.
---
[PUB-030] - Cases CMS model + listing + detail + filters
Status: DONE
Notes: Already implemented. /projecten has filterable listing by sector (erfgoed, onderwijs, zorg, residentieel, infrastructuur, overheid). /projecten/[slug] has detail with KPIs, challenge, approach, results sections. Data from FEATURED_PROJECTS with all required fields.
---
[PUB-040] - Procurement hub: Tender Pack request flow
Status: DONE
Notes: Created /procurement/documentatie with tender pack request form. Form captures: name, org, email, phone, purpose (aanbesteding/preselectie/raamcontract/other). Form submits to /api/leads creating lead record. Confirmation shown after submit. Documents list section shows available certificates.
---
[PUB-050] - Jobs: job detail + apply flow + JobPosting schema
Status: DONE
Notes: Created job detail pages with JobPosting JSON-LD schema. Apply form with CV upload (10MB limit) and GDPR consent. Confirmation message shown after submit, email noted as stub.
---
[PUB-060] - Contact flow → lead record
Status: DONE
Notes: Updated contact form to create lead records. Added organisation field. Lead type mapped from contact subject. Zod validation with full CONTACT_SUBJECTS alignment.
---
[ADM-010] - Cockpit v1: tiles + alerts + export
Status: DONE
Notes: Created directie cockpit with KPI tiles, tender/lead pipeline bars, expiry radar (30/60/90), alerts for new leads/analyzing tenders/expiring docs, and board pack export stub.
---
[ADM-020] - Lead hub v1: pipeline + assignment + reminders
Status: DONE
Notes: Created lead hub with pipeline and list views. Detail modal with contact info, assignment dropdown, notes, and next action date.
---
[ADM-030] - Tender hub v1: TED RSS ingest + opportunity list
Status: DONE
Notes: Created tender hub with full list view, status filters, deadline indicators, match scores. TED RSS parser in lib/tender/ted-rss.ts with CPV matching.
---
[ADM-040] - Tender go/no-go + checklist + decision log
Status: DONE
Notes: Created tender detail page with full go/no-go checklist (capacity, risk, margin, planning, references). Decision logging with user/timestamp.
---
[ADM-050] - Compliance vault: document types + expiry radar + tender pack templates
Status: DONE
Notes: Created compliance vault with document list, expiry radar (30/60/90 days), document type filters, and tender pack selection/export feature.
---
[ADM-060] - Recruitment hub v1: jobs CRUD + applications queue + retention
Status: DONE
Notes: Created recruitment hub with jobs/applications tabs, CRUD stubs, application detail modal with status workflow, CV download, and GDPR retention policy settings.
---
[ADM-070] - VDAB adapter stub + mapping
Status: DONE
Notes: Created VDAB adapter with full interface, job-to-VDAB mapping, publish/update/remove stubs. Integrated into recruitment hub with sync status.
---
[ADM-080] - Facility desk v1: tickets + SLA due + statuses
Status: DONE
Notes: Created facility desk with ticket list sorted by urgency/SLA. Full status workflow, SLA overdue highlighting, assignment dropdown, ticket detail modal.
---
[ADM-090] - Partner prequal v1: intake + doc checklist + review workflow
Status: DONE
Notes: Created partner prequal portal with partner list, document checklist (VCA, insurance, references), approval workflow, and document expiry tracking.
---
[ADM-100] - Analytics dashboard v1: events → KPI tiles
Status: DONE
Notes: Created analytics dashboard with KPI tiles (leads, response time, tender win rate, pipeline value), leads per month chart, job views vs applications, lead conversion funnel.
---
[COMPLETE] - All stories completed
Status: DONE
Notes: All 16 user stories implemented and verified. Growth OS v1 ready for sales demo.
---
[DATA-001] - Facility tickets Supabase data layer
Status: DONE
Notes: Created facility_tickets table with reference auto-generation, RLS policies, audit triggers. Added TypeScript types, query functions with seed fallback, updated page/client for props-based data flow.
---
[DATA-002] - Partners Supabase data layer
Status: DONE
Notes: Created partners + partner_documents tables with RLS, audit triggers, compliance status view. TypeScript types added. Query functions including getPartnersWithDocuments for nested data. Server page fetches data, client receives via props.
---
[DATA-003] - Leads write operations (notes, status, assignment)
Status: DONE
Notes: Created PATCH /api/leads/[id] for updating status, owner_id, next_action_date. Created POST/GET /api/leads/[id]/notes for lead notes. Added getLeadNotes query function. Updated leads-client.tsx to persist changes to Supabase instead of console.log. Added loading states and error handling.
---
[FIX-001] - Projectplanner backend integration
Status: DONE
Notes: Created /api/projectplanner route with Zod validation. Updated handleSubmit() to POST form data to API. Lead created with type 'project' and source 'projectplanner'. Human-readable message formatting with project details. Toast notifications for success/error.
---
[FIX-002] - Lead detail page
Status: DONE
Notes: Created /dashboard/leads/[id] with server + client components. Full lead info display (contact, org, message, type, status, budget, timing, source). Inline edit for status, owner, next action date. Notes section with add form and timeline. Back link to leads list.
---
[FIX-003] - Cases dashboard management
Status: DONE
Notes: Created /dashboard/cases with grid view of all cases. Stats cards (total/published/featured). Filters: search, sector (client_type), year. Case detail modal with KPIs display. Added Cases link to sidebar navigation.
---
[FIX-004] - Email notifications with Resend
Status: DONE
Notes: Created lib/email.ts with Resend integration for 3 email types (contact notification, application confirmation, HR notification). Professional HTML templates with De Raedt branding. Graceful fallback logs emails when RESEND_API_KEY missing. Updated contact and applications API routes. Added job_title to application submission.
---
[FIX-005] - DELETE API endpoints for GDPR compliance
Status: DONE
Notes: Added DELETE method to all 4 routes: leads (+ notes), applications (+ CV storage), facility-tickets, tenders. Audit logging via existing DB triggers.
---
[FIX-006] - Board Pack PDF export
Status: DONE
Notes: Installed jspdf library. Created lib/pdf/board-pack.ts with branded PDF generation (KPIs, pipelines, expiry radar, alerts). API route /api/export/board-pack generates PDF. Dashboard button triggers download.
---
[FIX-007] - Compliance document upload
Status: DONE
Notes: Created POST/GET /api/compliance-docs with Zod validation. Added upload modal to compliance client with form fields (name, type, issuer, reference, scope, dates, file). File validation for PDF/images max 10MB.
---
[FIX-008] - Facility ticket creation from dashboard
Status: DONE
Notes: Created POST/GET /api/facility-tickets with Zod validation. Auto-generates FT-YYYY-XXXX reference. SLA deadline calculated based on urgency (critical=4h, high=8h, medium=24h, low=72h). Added create ticket modal to facility dashboard with all required fields.
---
[COMPLETE] - All FIX stories completed
Status: DONE
Notes: All 8 FIX stories (FIX-001 to FIX-008) implemented and verified. Growth OS feature gaps addressed.
---
[PROD-001] - Schema alignment: API routes vs migrations
Status: DONE
Notes: Fixed compliance-docs API (removed invalid 'status' field). Fixed facility-tickets API (correct field mapping: title, reporter_*, sla_due_at). Form contact fields made required.
---
[PROD-002] - RBAC enforcement on all mutation endpoints
Status: DONE
Notes: Added RBAC permission actions to lib/supabase/auth.ts. All DELETE endpoints now check getCurrentUser + canPerformAction. Returns 401/403 for unauthorized access.
---
[PROD-003] - Cron authentication hardening
Status: DONE
Notes: Fixed auth bypass in tender-ingest cron. Returns 500 if CRON_SECRET not configured, 401 if invalid token. Logs all access attempts with client IP.
---
[PROD-004] - Seed data dev-only guard
Status: DONE
Notes: Added canUseSeedData() helper checking NODE_ENV. Updated all 15+ query functions. In production returns empty array, in dev logs warning and returns seed data.
---
[PROD-005] - Export RBAC + security headers
Status: DONE
Notes: Board pack export requires DIRECTIE role. Added security headers in next.config.ts: HSTS, X-Content-Type-Options, X-Frame-Options, X-XSS-Protection, Referrer-Policy, Permissions-Policy.
---
[PROD-006] - Rate limiting on public endpoints
Status: DONE
Notes: Created lib/rate-limit.ts with sliding window rate limiter. Added to /api/contact, /api/leads, /api/projectplanner, /api/applications. 10 requests/minute, returns 429 with Retry-After header.
---
[PROD-007] - Env validation + email production mode
Status: DONE
Notes: Created lib/config.ts with typed env object and helper functions. Email service throws in production if RESEND_API_KEY missing, logs in development. Lazy validation allows builds without env vars.
---
[COMPLETE] - All PROD stories completed
Status: DONE
Notes: All 7 PROD stories (PROD-001 to PROD-007) implemented and verified. Production-readiness gaps addressed: schema alignment, RBAC enforcement, cron security, seed data guards, security headers, rate limiting, env validation.
---
[I18N-001] - Contact page i18n
Status: DONE
Notes: Added useTranslations('contact') hook. Extended contact section in all 3 translation files (nl.json, fr.json, en.json) with hero, cards, responseTime, form, subjects, success, toast, company, map keys. Uses t.rich() for rich text with highlight tags. All hardcoded Dutch strings replaced.
---
[I18N-002] - Careers (werken-bij) page i18n
Status: DONE
Notes: Added useTranslations('careers') hook. Extended careers section in all 3 translation files with hero, stats, employmentTypes, benefitsSection, team, culture, positions, cta keys. Used typed const arrays (BENEFIT_KEYS, CULTURE_KEYS, etc.) for safe key iteration. All hardcoded Dutch strings replaced.
---
[I18N-003] - Projects (projecten) page i18n
Status: DONE
Notes: Added projectsPage section to all 3 translation files with hero, stats, filter, card, cta, empty keys. Used typed const arrays for stats. Updated Link import to use @/i18n/navigation. All hardcoded Dutch strings replaced.
---
[I18N-004] - About (over-ons) page i18n
Status: DONE
Notes: Added aboutPage section to all 3 translation files with hero, stats, mission, story, timeline, values, team, cta keys. Used typed const arrays for values (VALUE_KEYS), timeline (TIMELINE_YEARS), and team features (TEAM_FEATURE_KEYS). Used interpolation for dynamic values (years, employees).
---
[I18N-005] - Services (diensten) page i18n
Status: DONE
Notes: Added servicesPage section to all 3 translation files with hero, stats, nav, services (4 items with features arrays), card, process (5 steps), cta keys. Used typed const arrays (SERVICE_IDS, HERO_STAT_KEYS, PROCESS_STEPS) for safe iteration. Used t.raw() for array translations.
---
[I18N-006] - Privacy page i18n
Status: DONE
Notes: Added comprehensive privacy section to all 3 translation files with 10 sections covering data controller, collection, purposes, legal basis, retention, rights, security, third parties, complaints, and changes. Used typed const arrays (DATA_COLLECTION_KEYS, RIGHTS_KEYS) for safe iteration. Used t.raw() for array translations.
---
[I18N-007] - Cookies page i18n
Status: DONE
Notes: Added comprehensive cookies section to all 3 translation files with sections for what cookies are, cookie types (necessary/analytics), table headers/values, choices, browser management, and contact. Cookie tables include consent and auth cookies.
---
[I18N-008] - ProjectPlanner wizard i18n
Status: DONE
Notes: Expanded projectPlanner section in all 3 translation files with questions, options (projectTypes, clientTypes, budgets, timelines, locations), form fields, buttons, success/toast messages. Refactored page to use useTranslations hook with typed const arrays for options. Split options helpers for type safety.
---
